<%= 
  calendar(
      :year => @date.year,
      :month => @date.month,
      # ugly hack to punch in data attributes
      :table_class => "calendar #{@table_class}\" data-calendar-year=\"#{@date.year}\" data-calendar-month=\"#{@date.month}\" data-year-start=\"1994\" data-year-end=\"#{Time.now.year}\"",
      :previous_month_text => @date.months_ago(1)   > Entry.earliest_publication_date ? link_to('&laquo; Prev', entries_by_month_path(@date.months_ago(1)), :class => 'nav')   : "",
      :next_month_text     => @date.months_since(1) <= Issue.current.publication_date ? link_to('Next &raquo;', entries_by_month_path(@date.months_since(1)), :class => 'nav') : "",
      :abbrev => (0..0),
      :month_name_class => "monthName year_#{@date.year}"
  ) do |d|
    if d.wday == 0 || d.wday == 6
      [d.mday, {:class => "weekend"}]
    elsif d == Time.current.to_date && Issue.current_issue_is_late?
      [d.mday, {:class => "late" }]
    elsif d == @current_date
      [link_to(d.mday, entries_by_date_path(d)), {:class => "current" }]
    elsif @entry_dates.include?(d)
      [link_to(d.mday, entries_by_date_path(d)), {:class => "published" }]
    elsif holiday = Holiday.find_by_date(d)
      [d.mday, {:class => "holiday", :title => holiday.name}]
    else
      [d.mday]
    end
  end
%>
